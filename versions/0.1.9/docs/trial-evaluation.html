<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Trial Evaluation · Ax</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="There are 3 paradigms for evaluating [trials](/versions/0.1.9/docs/glossary.html#trial):"/><meta name="docsearch:version" content="0.1.9"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Trial Evaluation · Ax"/><meta property="og:type" content="website"/><meta property="og:url" content="https://ax.dev//versions/0.1.9/index.html"/><meta property="og:description" content="There are 3 paradigms for evaluating [trials](/versions/0.1.9/docs/glossary.html#trial):"/><meta property="og:image" content="https://ax.dev//versions/0.1.9/img/ax.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://ax.dev//versions/0.1.9/img/ax.svg"/><link rel="shortcut icon" href="/versions/0.1.9/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-139570076-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://cdn.plot.ly/plotly-latest.min.js"></script><script type="text/javascript" src="/versions/0.1.9/js/plotUtils.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/versions/0.1.9/js/mathjax.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/versions/0.1.9/js/scrollSpy.js"></script><link rel="stylesheet" href="/versions/0.1.9/css/main.css"/><script src="/versions/0.1.9/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/versions/0.1.9/"><img class="logo" src="/versions/0.1.9/img/ax_lockup_white.svg" alt="Ax"/><h2 class="headerTitleWithLogo">Ax</h2></a><a href="/versions/0.1.9/versions.html"><h3>0.1.9</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/versions/0.1.9/docs/why-ax.html" target="_self">Docs</a></li><li class=""><a href="/versions/0.1.9/tutorials/" target="_self">Tutorials</a></li><li class=""><a href="/versions/0.1.9/api/" target="_self">API</a></li><li class=""><a href="https://github.com/facebook/Ax" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Components</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/why-ax.html">Why Ax?</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/installation.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/api.html">APIs</a></li><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/glossary.html">Glossary</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Algorithms</h3><ul class=""><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/bayesopt.html">Bayesian Optimization</a></li><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/banditopt.html">Bandit Optimization</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Components</h3><ul class=""><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/core.html">Core</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/versions/0.1.9/docs/trial-evaluation.html">Trial Evaluation</a></li><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/data.html">Data</a></li><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/models.html">Models</a></li><li class="navListItem"><a class="navItem" href="/versions/0.1.9/docs/storage.html">Storage</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Trial Evaluation</h1></header><article><div><span><p>There are 3 paradigms for evaluating <a href="/versions/0.1.9/docs/glossary.html#trial">trials</a>:</p>
<h3><a class="anchor" aria-hidden="true" id="synchronous"></a><a href="#synchronous" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Synchronous</h3>
<p>In the synchronous paradigm, the user specifies an evaluation function which takes in parameters and outputs metric outcomes. This use case is supported by the <a href="/api/core.html#module-ax.core.simple_experiment"><code>SimpleExperiment</code></a> class:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> ax <span class="hljs-keyword">import</span> *

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dummy_evaluation_function</span><span class="hljs-params">(
    parameterization, <span class="hljs-comment"># dict of parameter names to values of those parameters</span>
    weight=None, <span class="hljs-comment"># optional weight argument</span>
)</span>:</span>
    <span class="hljs-comment"># given parameterization, compute a value for each metric</span>
    x = parameterization[<span class="hljs-string">"x"</span>]
    y = parameterization[<span class="hljs-string">"y"</span>]
    objective_val = f(x, y)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"objective"</span>: objective_val}

exp = SimpleExperiment(
    name=<span class="hljs-string">"simple_experiment"</span>,
    search_space=SearchSpace(
      parameters=[
        RangeParameter(name=<span class="hljs-string">"x"</span>, lower=<span class="hljs-number">0.0</span>, upper=<span class="hljs-number">1.0</span>, parameter_type=ParameterType.FLOAT),
        RangeParameter(name=<span class="hljs-string">"y"</span>, lower=<span class="hljs-number">0.0</span>, upper=<span class="hljs-number">1.0</span>, parameter_type=ParameterType.FLOAT),
      ]
    ),
    evaluation_function=dummy_evaluation_function,
    objective_name=<span class="hljs-string">"objective"</span>,
)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="asynchronous"></a><a href="#asynchronous" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Asynchronous</h3>
<p>In the asynchronous paradigm, the trial is first deployed and the data is fetched at a later time. This is useful when evaluation happens on an external system and takes a long time to complete, such as for A/B tests. This is supported by the <a href="/api/core.html#module-ax.core.experiment"><code>Experiment</code></a> class. In this paradigm, the user specifies:</p>
<ul>
<li><a href="../api/core.html#ax.core.runner.Runner"><code>Runner</code></a>: Defines how to deploy the experiment.</li>
<li>List of <a href="../api/core.html#ax.core.metric.Metric"><code>Metrics</code></a>: Each defining how to compute/fetch data for a given metric.</li>
</ul>
<p>A default runner is specified on the experiment, which is attached to each trial right before deployment. Runners can also be manually added to a trial to override the experiment default.</p>
<h3><a class="anchor" aria-hidden="true" id="service-like"></a><a href="#service-like" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Service-like</h3>
<p>It is also possible to use Ax in a service-like manner, where Ax just suggests
<a href="/versions/0.1.9/docs/glossary.html#arm">Arms</a>, which the client application evaluates and logs the results
back to Ax. In this case, no runner or evaluation function is needed,
since the evaluation is done on the client side. For more information,
refer to <a href="/api/service.html"><code>Service</code></a> module
reference and the <a href="/versions/0.1.9/docs/api.html">API docs</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="evaluation-function"></a><a href="#evaluation-function" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Evaluation Function</h2>
<p>In synchronous cases where a parameterization can be evaluated right away (for example, when optimizing ML models locally or using a synthetic function), an evaluation function is a convenient way to automate evaluation. The arguments to an evaluation function must be:</p>
<ul>
<li><code>parameterization</code>, a mapping of parameter names to their values,</li>
<li>optionally a <code>weight</code> of the parameterization –– nullable <code>float</code> representing the fraction of available data on which the parameterization should be evaluated. For example, this could be a downsampling rate in case of hyperparameter optimization (what portion of data the ML model should be trained on for evaluation) or the percentage of users exposed to a given configuration in A/B testing. This <code>weight</code> is not used in unweighted experiments and defaults to <code>None</code>.</li>
</ul>
<p>An evaluation function can return:</p>
<ul>
<li>A dictionary of metric names to tuples of (mean and <a href="/versions/0.1.9/docs/glossary.html#sem">SEM</a>)</li>
<li>A single (mean, SEM) tuple</li>
<li>A single mean</li>
</ul>
<p>In the second case, Ax will assume that the mean and the SEM are for the experiment objective, and in the third case that the mean is for the objective and that SEM is 0.</p>
<p>For example, this evaluation function computes mean and SEM for <a href="https://www.sfu.ca/~ssurjano/hart6.html">Hartmann6</a> function and for the L2-norm:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> ax.utils.measurement.synthetic_functions <span class="hljs-keyword">import</span> hartmann6
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hartmann_evaluation_function</span><span class="hljs-params">(parameterization)</span>:</span>
    x = np.array([parameterization.get(<span class="hljs-string">f"x<span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>"</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">6</span>)])
    <span class="hljs-comment"># Standard error is 0, since we are computing a synthetic function.</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"hartmann6"</span>: (hartmann6(x), <span class="hljs-number">0.0</span>), <span class="hljs-string">"l2norm"</span>: (np.sqrt((x ** <span class="hljs-number">2</span>).sum()), <span class="hljs-number">0.0</span>)}
</code></pre>
<p>This function computes just the objective mean and SEM, assuming the <a href="https://www.sfu.ca/~ssurjano/branin.html">Branin</a> function is the objective on the experiment:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> ax.utils.measurement.synthetic_functions <span class="hljs-keyword">import</span> branin
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">branin_evaluation_function</span><span class="hljs-params">(parameterization)</span>:</span>
    <span class="hljs-comment"># Standard error is 0, since we are computing a synthetic function.</span>
    <span class="hljs-keyword">return</span> (branin(parameterization.get(<span class="hljs-string">"x1"</span>), parameterization.get(<span class="hljs-string">"x2"</span>)), <span class="hljs-number">0.0</span>)
</code></pre>
<p>This form would be equivalent to the above, since SEM is 0:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">lambda</span> parameterization: branin(parameterization.get(<span class="hljs-string">"x1"</span>), parameterization.get(<span class="hljs-string">"x2"</span>))
</code></pre>
<p>For an example of an evaluation function that makes use of the <code>weight</code> argument, refer to the &quot;Bandit Optimization&quot; tutorial.</p>
<h2><a class="anchor" aria-hidden="true" id="adding-your-own-runner"></a><a href="#adding-your-own-runner" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding Your Own Runner</h2>
<p>In order to control how the experiment is deployed, you can add your own runner. To do so, subclass <a href="../api/core.html#ax.core.runner.Runner"><code>Runner</code></a> and implement the <a href="../api/core.html#ax.core.runner.Runner.run"><code>run</code></a> method and <a href="../api/core.html#ax.core.runner.Runner.staging_required"><code>staging_required</code></a> property.</p>
<p>The <a href="../api/core.html#ax.core.runner.Runner.run"><code>run</code></a> method accepts a <a href="../api/core.html#ax.core.trial.Trial"><code>Trial</code></a> and returns a JSON-serializable dictionary of any necessary tracking info to fetch data later from this external system. A unique identifier or name for this trial in the external system should be stored in this dictionary with the key <code>&quot;name&quot;</code>, and this can later be accessed via <code>trial.deployed_name</code>.</p>
<p>The <a href="../api/core.html#ax.core.runner.Runner.staging_required"><code>staging_required</code></a> indicates whether the trial requires an intermediate staging period before evaluation begins. This property returns False by default.</p>
<p>An example implementation is given below:</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> foo_system <span class="hljs-keyword">import</span> deploy_to_foo
<span class="hljs-keyword">from</span> ax <span class="hljs-keyword">import</span> Runner

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooRunner</span><span class="hljs-params">(Runner)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, foo_param)</span>:</span>
        self.foo_param = foo_param

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self, trial)</span>:</span>
        name_to_params = {
            arm.name: arm.params <span class="hljs-keyword">for</span> arm <span class="hljs-keyword">in</span> trial.arms
        }
        run_metadata = deploy_to_foo(foo_param, name_to_params)
        <span class="hljs-keyword">return</span> run_metadata

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">staging_required</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p>This is then invoked by calling:</p>
<pre><code class="hljs css language-python">exp = Experiment(...)
exp.runner = FooRunner(foo_param=<span class="hljs-string">"foo"</span>)
trial = exp.new_batch_trial()

<span class="hljs-comment"># This calls runner's run method and stores metadata output</span>
<span class="hljs-comment"># in the trial.run_metadata field</span>
trial.run()
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/versions/0.1.9/docs/core.html"><span class="arrow-prev">← </span><span>Core</span></a><a class="docs-next button" href="/versions/0.1.9/docs/data.html"><span>Data</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#evaluation-function">Evaluation Function</a></li><li><a href="#adding-your-own-runner">Adding Your Own Runner</a></li></ul></nav></div><footer class="nav-footer" id="footer"><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/versions/0.1.9/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook Inc.</section></footer></div></body></html>